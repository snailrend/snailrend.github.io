<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql语法学习 | 自旋向上</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="alternate" type="application/rss+xml" href="http://snailrend.github.io/rss.xml" title="自旋向上 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="http://snailrend.github.io/feed.atom" title="自旋向上 Atom Feed">
    <link rel="alternate" type="application/json" href="http://snailrend.github.io/feed.json" title="自旋向上 JSON Feed">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.a8e1f766.css" as="style"><link rel="preload" href="/assets/js/app.65b26f92.js" as="script"><link rel="preload" href="/assets/js/2.688822e6.js" as="script"><link rel="preload" href="/assets/js/23.fe222df9.js" as="script"><link rel="prefetch" href="/assets/js/10.c52f3046.js"><link rel="prefetch" href="/assets/js/11.19cbf741.js"><link rel="prefetch" href="/assets/js/12.bbab3e89.js"><link rel="prefetch" href="/assets/js/13.3f767b22.js"><link rel="prefetch" href="/assets/js/14.7f711bfe.js"><link rel="prefetch" href="/assets/js/15.6046bb7b.js"><link rel="prefetch" href="/assets/js/16.5d94747f.js"><link rel="prefetch" href="/assets/js/17.cefe4b7d.js"><link rel="prefetch" href="/assets/js/18.b1caf92b.js"><link rel="prefetch" href="/assets/js/19.86954bdc.js"><link rel="prefetch" href="/assets/js/20.8ddafb15.js"><link rel="prefetch" href="/assets/js/21.e39934e4.js"><link rel="prefetch" href="/assets/js/22.3404e32b.js"><link rel="prefetch" href="/assets/js/24.e2d88183.js"><link rel="prefetch" href="/assets/js/25.4656273c.js"><link rel="prefetch" href="/assets/js/26.6877622b.js"><link rel="prefetch" href="/assets/js/27.91ce27c4.js"><link rel="prefetch" href="/assets/js/28.6502a414.js"><link rel="prefetch" href="/assets/js/29.24e5de17.js"><link rel="prefetch" href="/assets/js/3.9403f813.js"><link rel="prefetch" href="/assets/js/30.663a33ab.js"><link rel="prefetch" href="/assets/js/31.fa9ebfb5.js"><link rel="prefetch" href="/assets/js/32.6f6a2225.js"><link rel="prefetch" href="/assets/js/33.e5848d71.js"><link rel="prefetch" href="/assets/js/34.5ccf98bc.js"><link rel="prefetch" href="/assets/js/35.8d77177d.js"><link rel="prefetch" href="/assets/js/36.d21862f1.js"><link rel="prefetch" href="/assets/js/4.32c10b23.js"><link rel="prefetch" href="/assets/js/5.38ca723e.js"><link rel="prefetch" href="/assets/js/6.1aac1c16.js"><link rel="prefetch" href="/assets/js/7.6a90bb50.js"><link rel="prefetch" href="/assets/js/8.fa1d823e.js"><link rel="prefetch" href="/assets/js/9.bdacdf25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a8e1f766.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">自旋向上</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SOP" class="dropdown-title"><span class="title">SOP</span> <span class="arrow down"></span></button> <button type="button" aria-label="SOP" class="mobile-dropdown-title"><span class="title">SOP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SOP/开发/" class="nav-link">
  开发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="template" class="dropdown-title"><span class="title">template</span> <span class="arrow down"></span></button> <button type="button" aria-label="template" class="mobile-dropdown-title"><span class="title">template</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/template/" class="nav-link">
  Template
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/" class="nav-link">
  前端
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/后端/数据库/" class="nav-link">
  数据库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="环境安装" class="dropdown-title"><span class="title">环境安装</span> <span class="arrow down"></span></button> <button type="button" aria-label="环境安装" class="mobile-dropdown-title"><span class="title">环境安装</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/环境安装/" class="nav-link">
  环境安装
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="职场" class="dropdown-title"><span class="title">职场</span> <span class="arrow down"></span></button> <button type="button" aria-label="职场" class="mobile-dropdown-title"><span class="title">职场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/职场/年终总结/" class="nav-link">
  年终总结
</a></li><li class="dropdown-item"><!----> <a href="/职场/" class="nav-link">
  职场
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计划" class="dropdown-title"><span class="title">计划</span> <span class="arrow down"></span></button> <button type="button" aria-label="计划" class="mobile-dropdown-title"><span class="title">计划</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/计划/" class="nav-link">
  计划
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SOP" class="dropdown-title"><span class="title">SOP</span> <span class="arrow down"></span></button> <button type="button" aria-label="SOP" class="mobile-dropdown-title"><span class="title">SOP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SOP/开发/" class="nav-link">
  开发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="template" class="dropdown-title"><span class="title">template</span> <span class="arrow down"></span></button> <button type="button" aria-label="template" class="mobile-dropdown-title"><span class="title">template</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/template/" class="nav-link">
  Template
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/" class="nav-link">
  前端
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/后端/数据库/" class="nav-link">
  数据库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="环境安装" class="dropdown-title"><span class="title">环境安装</span> <span class="arrow down"></span></button> <button type="button" aria-label="环境安装" class="mobile-dropdown-title"><span class="title">环境安装</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/环境安装/" class="nav-link">
  环境安装
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="职场" class="dropdown-title"><span class="title">职场</span> <span class="arrow down"></span></button> <button type="button" aria-label="职场" class="mobile-dropdown-title"><span class="title">职场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/职场/年终总结/" class="nav-link">
  年终总结
</a></li><li class="dropdown-item"><!----> <a href="/职场/" class="nav-link">
  职场
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计划" class="dropdown-title"><span class="title">计划</span> <span class="arrow down"></span></button> <button type="button" aria-label="计划" class="mobile-dropdown-title"><span class="title">计划</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/计划/" class="nav-link">
  计划
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/后端/数据库/mysql语法学习.html" class="active sidebar-link">mysql语法学习</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/后端/数据库/mysql进阶学习.html" class="sidebar-link">mysql进阶学习</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql语法学习"><a href="#mysql语法学习" class="header-anchor">#</a> mysql语法学习</h1> <h3 id="sql增删改查"><a href="#sql增删改查" class="header-anchor">#</a> SQL增删改查</h3> <h4 id="insert"><a href="#insert" class="header-anchor">#</a> insert</h4> <p>语法：insert [into] &lt;表名&gt; [列名] values &lt;列值&gt;</p> <p>如果要插入的数据包括所有字段,那么可以省略<code>[列名]</code>,但是数据的顺序需要是建表时的字段顺序</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> user_info<span class="token punctuation">(</span>user_name<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>gender<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'Song'</span><span class="token punctuation">,</span><span class="token string">'15999999999'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>也可以用于表数据的迁移:</p> <p>语法：insert into &lt;已有的新表&gt; [列名] select &lt;原表列名&gt; from &lt;原表名&gt;</p> <p>此处的<code>[列名]</code>同样可以省略</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> user_info_new <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info_old <span class="token keyword">where</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>特别注意的是后面的 select 语句一定要加 where 条件,否则一定会进行全表扫描,如果是在生产环境,数据量极大又全表扫描的情况下会导致数据库宕机,导致其他服务受极大影响,不过如果加的 where 条件中的字段没有索引,也会导致全表扫描</strong></p> <h4 id="delete"><a href="#delete" class="header-anchor">#</a> delete</h4> <p>语法：delete from &lt;表名&gt; [where &lt;删除条件&gt;]</p> <p>where 条件如果没有,则会删除整个表的数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> user_info <span class="token keyword">where</span> user_name<span class="token operator">=</span><span class="token string">'Song'</span>
</code></pre></div><p>如果要删除整张表的数据也可以使用下面这种方法:</p> <p>语法：truncate table &lt;表名&gt;</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">truncate</span> <span class="token keyword">table</span> user_info
</code></pre></div><h4 id="update"><a href="#update" class="header-anchor">#</a> update</h4> <p>语法：update &lt;表名&gt; set &lt;列名=更新值&gt; [where &lt;更新条件&gt;]</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> user_info <span class="token keyword">set</span> age<span class="token operator">=</span><span class="token number">18</span> <span class="token keyword">where</span> user_name<span class="token operator">=</span><span class="token string">'Song'</span>
</code></pre></div><h4 id="select"><a href="#select" class="header-anchor">#</a> select</h4> <p>语法：select &lt;列名&gt; from &lt;表名&gt; [where &lt;查询条件表达试&gt;] [order by &lt;排序的列名&gt;[asc或desc]]</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info <span class="token keyword">where</span> age<span class="token operator">&gt;=</span><span class="token number">18</span> <span class="token keyword">order</span> <span class="token keyword">by</span> age <span class="token keyword">asc</span>
</code></pre></div><p><code>order by</code>语句可以限定根据某个字段进行排序,后面的<code>asc</code>代表升序,<code>desc</code>代表降序.</p> <p>可以在查询语句最后加上<code>limit</code>限定查询结果的行数:</p> <div class="language- extra-class"><pre class="language-text"><code>select * from user_info where age&gt;=18 order by age asc limit 10
</code></pre></div><p>也可以进行子查询:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info <span class="token keyword">where</span> age<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">)</span> <span class="token keyword">user</span> <span class="token keyword">where</span> gender<span class="token operator">=</span><span class="token string">'男'</span>
</code></pre></div><h3 id="sql关联查询"><a href="#sql关联查询" class="header-anchor">#</a> SQL关联查询</h3> <h4 id="inner-join"><a href="#inner-join" class="header-anchor">#</a> inner join</h4> <p><code>inner join</code>可以将两张表根据条件连接在一起,条件不相等则不会出现在结果集中</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info u <span class="token keyword">inner</span> <span class="token keyword">join</span> guard g <span class="token keyword">on</span> u<span class="token punctuation">.</span>user_id<span class="token operator">=</span>g<span class="token punctuation">.</span>user_id
</code></pre></div><p><code>inner join</code>也可简写成<code>join</code></p> <p>在<code>inner join</code>语句后面也可以加上<code>where</code>语句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info u <span class="token keyword">inner</span> <span class="token keyword">join</span> guard g <span class="token keyword">on</span> u<span class="token punctuation">.</span>user_id<span class="token operator">=</span>g<span class="token punctuation">.</span>user_id <span class="token keyword">where</span> u<span class="token punctuation">.</span>age<span class="token operator">&gt;</span><span class="token number">18</span>
</code></pre></div><h4 id="left-join-right-join"><a href="#left-join-right-join" class="header-anchor">#</a> left join/right join</h4> <p><code>left join</code>与<code>right join</code>与<code>inner join</code>有所不同,它们会选取其中一个表作为主表,主表的数据,即使在<code>on</code>条件中没有符合,数据依然会出现在结果集中,<code>left join</code>是以左边的表为主表,<code>right join</code>是已右边的表作为主表.</p> <p>下面的示例表示已<code>user_info</code>表作为主表,无论有另一个表有没有<code>user_id</code>字段相等的数据,主表的数据都会出现在结果集中.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info u <span class="token keyword">left</span> <span class="token keyword">join</span> guard g <span class="token keyword">on</span> u<span class="token punctuation">.</span>user_id<span class="token operator">=</span>g<span class="token punctuation">.</span>user_id 
</code></pre></div><p>如果换成 <code>right join</code>也可达到相同的效果:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> guard g <span class="token keyword">right</span> joinuser_info u <span class="token keyword">on</span> u<span class="token punctuation">.</span>user_id<span class="token operator">=</span>g<span class="token punctuation">.</span>user_id 
</code></pre></div><h4 id="union"><a href="#union" class="header-anchor">#</a> union</h4> <p><code>union</code>就是并集操作,将两次查询的结果进行并集,默认是去除两个结果集中的重复记录</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info <span class="token keyword">where</span> gender<span class="token operator">=</span><span class="token string">'男'</span>
<span class="token keyword">union</span> 
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_info <span class="token keyword">where</span> age<span class="token operator">&gt;</span><span class="token number">50</span>
</code></pre></div><p>如果想保留重复的记录,可以使用<code>union all</code></p> <h3 id="数据库字符集与校对规则"><a href="#数据库字符集与校对规则" class="header-anchor">#</a> 数据库字符集与校对规则</h3> <p>MySQL中的<code>utf8</code>字符集并不完整，只支持<code>3bytes</code>的文字，这是历史遗留问题，在MySQL中要使用<code>utf8mb4</code>才能支持占用<code>4bytes</code>的文字，一般而言都使用<code>utf8mb4</code>字符集。</p> <p>校对规则比较常用的是<code>utf8mb4_general_ci</code>、<code>utf8mb4_unicode_ci</code>、<code>utf8mb4_bin</code>，校对规则的命名约定：以其相关的<strong>字符集名开始</strong>，中间包括一个<strong>语言名</strong>，并且以**_ci**（大小写不敏感）、<strong>_cs</strong>（大小写敏感）或**_bin**（二元）结束。</p> <p>以上常用的校对规则中，前两个两个是大小写不敏感的，最后一个是按照二进制来校对排序的，所以是大小写敏感的。</p> <blockquote><p>而<code>utf8mb4_unicode_ci</code>和<code>utf8mb4_general_ci</code>对于中文和英文来说，其实是没有任何区别的。对于我们开发的国内使用的系统来说，随便选哪个都行。只是对于某些西方国家的字母来说，<code>utf8mb4_unicode_ci</code>会比<code>utf8mb4_general_ci</code>更符合他们的语言习惯一些，<code>general</code>是mysql一个比较老的标准了。例如，德语字母<code>“ß”</code>，在<code>utf8mb4_unicode_ci</code>中是等价于<code>&quot;ss&quot;</code>两个字母的（这是符合德国人习惯的做法），而在<code>utf8mb4_general_ci</code>中，它却和字母<code>“s”</code>等价。不过，这两种编码的那些微小的区别，对于正常的开发来说，很难感知到。</p> <p>作者：腾讯云加社区
链接：https://juejin.im/post/5bfe5cc36fb9a04a082161c2
来源：掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote> <p>所以比较推荐使用<code>utf8mb4_unicode_ci</code>的校对规则。</p> <h3 id="数据库索引"><a href="#数据库索引" class="header-anchor">#</a> 数据库索引</h3> <p>索引可以优化数据库查询速度,应该在经常被查询的字段上使用索引,常见的<code>primary key</code>也是一种索引,索引的创建方法有三种,以下以普通索引为例:</p> <ul><li><p>直接创建索引</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> mytable<span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div></li> <li><p>修改表结构添加索引</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">table</span> tableName <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> indexName<span class="token punctuation">(</span>columnName<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>创建表时指定索引</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>  
 
ID <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   
 
username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  
 
<span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>  
 
<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div></li></ul> <p>删除索引方式如下:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token keyword">ON</span> mytable<span class="token punctuation">;</span> 
</code></pre></div><p><strong>索引有以下类别</strong>:</p> <ol><li><p>普通索引</p></li> <li><p>唯一索引</p> <p>建立索引的字段不可有重复值,修改表结构以及创建表结构的时候创建索引时不需要<code>index</code>关键字,只需要<code>unique</code>就行.</p></li> <li><p>主键索引</p> <p>主键索引是一种特殊的唯一索引,使用<code>primary key</code>关键字创建索引.</p></li> <li><p>组合索引</p> <p>组合索引就是在多一个字段上创建索引,使用索引时,在索引的左前缀集合中即可使用索引.</p></li> <li><p>全文索引</p> <p>用于查找文本的关键字,查询时配合<code>match aginst</code>使用.</p></li></ol> <p><strong>索引使用注意事项</strong></p> <ol><li>索引不会包含有NULL值的列,如果列中有NULL值,则此索引就无效</li> <li>尽量使用断索引</li> <li>一条语句只使用一个索引,如果<code>where</code>中使用了索引,<code>order by</code>中是不会使用索引的</li> <li>like语句只有类似'aaa%'的条件才会使用索引</li> <li>在列上进行计算会导致索引失效</li></ol> <h3 id="sql执行计划"><a href="#sql执行计划" class="header-anchor">#</a> SQL执行计划</h3> <p>sql执行计划就是一条SQL对表的操作顺序,使用<code>EXPLAIN</code>关键字写在一条SQL前面进行执行,就可以看到这条SQL的执行计划了会出现有如下字段的表格</p> <ul><li><p><strong>id</strong></p> <p>表示查询中select子句或操作表的顺序,id的值越大执行的优先级越高,越先执行,如果id相同,则执行顺序是从上到下</p></li> <li><p><strong>select_type</strong></p> <p>表示查询子句的类型,类型如下:</p> <ul><li>simple:查询中不包含子查询或者 union</li> <li>primary:包含子查询或者其他复杂子部分的语句</li> <li>subquery:包含在select 或者 where后面的子查询</li> <li>derived:包含在 from 后面的的子查询</li> <li>union:在union 后的查询语句</li> <li>union result:从UNION中获取结果集</li></ul></li> <li><p><strong>table</strong>  表示要操作的数据表</p></li> <li><p><strong>partitions</strong> 要操作的表分区</p></li> <li><p><strong>type</strong></p> <p>表示访问类型,类型如下</p> <p><code>ALL</code>   扫描全表数据</p> <p><code>index</code> 遍历索引</p> <p><code>range</code> 索引范围查找</p> <p><code>index_subquery</code> 在子查询中使用 ref</p> <p><code>unique_subquery</code> 在子查询中使用 eq_ref</p> <p><code>ref_or_null</code> 对<code>Null</code>进行索引的优化的 ref</p> <p><code>fulltext</code> 使用全文索引</p> <p><code>ref</code>   使用非唯一索引查找数据</p> <p><code>eq_ref</code> 在<code>join</code>查询中使用<code>PRIMARY KEY</code>or<code>UNIQUE NOT NULL</code>索引关联。</p></li> <li><p><strong>possible_keys</strong>  有可能使用的索引</p></li> <li><p><strong>key</strong>   实际使用的索引</p></li> <li><p><strong>key_len</strong> 索引长度</p></li> <li><p><strong>ref</strong>   表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</p></li> <li><p><strong>rows</strong>  结果集数目的估算数</p></li> <li><p><strong>filtered</strong></p></li> <li><p><strong>extra</strong> 其他信息</p></li></ul> <p>通过查看SQL的执行计划,可以看出复杂语句的执行顺序,是否使用索引等信息,通过执行计划,可以对SQL进行优化,对于没有使用索引的SQL要考虑加索引</p> <h3 id="分析sql执行效率与优化"><a href="#分析sql执行效率与优化" class="header-anchor">#</a> 分析SQL执行效率与优化</h3> <blockquote><h4 id="单表优化"><a href="#单表优化" class="header-anchor">#</a> 单表优化</h4> <p>除非单表数据未来会一直不断上涨，否则<strong>不要一开始就考虑拆分</strong>，拆分会带来逻辑、部署、运维的各种复杂度，一般以整型值为主的表在<strong>千万级</strong>以下，字符串为主的表在<strong>五百万</strong>以下是没有太大问题的。</p> <p>而事实上很多时候 MySQL 单表的性能依然有不少优化空间，甚至能正常支撑<strong>千万级</strong>以上的数据量。</p> <h4 id="字段"><a href="#字段" class="header-anchor">#</a> 字段</h4> <ul><li>尽量使用 <code>TINYINT</code>、 <code>SMALLINT</code>、 <code>MEDIUM_INT</code> 作为整数类型而非 <code>INT</code>，如果非负则加上 <code>UNSIGNED</code></li> <li><code>VARCHAR</code> 的长度只分配真正需要的空间</li> <li>使用枚举或整数代替字符串类型</li> <li>尽量使用 <code>TIMESTAMP</code> 而非 <code>DATETIME</code></li> <li>单表不要有太多字段，建议在 <strong>20</strong> 以内</li> <li>避免使用 <code>NULL</code> 字段，很难查询优化且占用额外索引空间</li> <li>用整型来存 <strong>IP</strong></li></ul> <h4 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h4> <ul><li>索引并不是越多越好，要根据查询有针对性的创建，考虑在 <code>WHERE</code> 和 <code>ORDER BY</code> 命令上涉及的列建立索引，可根据 <code>EXPLAIN</code> 来查看是否用了索引还是全表扫描</li> <li>应尽量避免在 <code>WHERE</code> 子句中对字段进行 <code>NULL</code> 值判断，否则将导致引擎放弃使用索引而进行全表扫描</li> <li>值分布很稀少的字段不适合建索引，例如&quot;性别&quot;这种只有两三个值的字段</li> <li>字符字段只建前缀索引</li> <li>字符字段最好不要做主键</li> <li>不用外键，由程序保证约束</li> <li>尽量不用 <code>UNIQUE</code>，由程序保证约束</li> <li>使用多列索引时主意顺序和查询条件保持一致，同时删除不必要的单列索引</li></ul> <h4 id="查询sql"><a href="#查询sql" class="header-anchor">#</a> 查询SQL</h4> <ul><li>可通过开启慢查询日志来找出较慢的 SQL</li> <li>不做列运算： <code>SELECT id WHERE age+1=10</code>，任何对列的操作都将导致表扫描，它包括数据库教程函数、计算表达式等等，查询时要尽可能将操作移至等号右边</li> <li>sql 语句尽可能简单：一条 sql 只能在一个 cpu 运算；大语句拆小语句，减少锁时间；一条大sql 可以堵死整个库</li> <li>不用 <code>SELECT *</code></li> <li><code>OR</code> 改写成 <code>IN</code>： <code>OR</code> 的效率是 n 级别， <code>IN</code> 的效率是 log(n) 级别，<code>IN</code> 的个数建议控制在 200 以内</li> <li>不用函数和触发器，在应用程序实现</li> <li>避免 <code>%xxx</code> 式查询</li> <li>少用 <code>JOIN</code></li> <li>使用同类型进行比较，比如用 '123' 和 '123' 比， 123 和 123 比</li> <li>尽量避免在 <code>WHERE</code> 子句中使用 <code>!=</code> 或 <code>&lt;&gt;</code> 操作符，否则将引擎放弃使用索引而进行全表扫描</li> <li>对于连续数值，使用 <code>BETWEEN</code> 不用 <code>IN</code>： <code>SELECT id FROM t WHERE num BETWEEN 1 AND 5</code></li> <li>列表数据不要拿全表，要使用 <code>LIMIT</code> 来分页，每页数量也不要太大</li></ul> <p>作者：低至一折起
链接：https://juejin.im/post/5b7d52afe51d453885030b91
来源：掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/后端/数据库/mysql进阶学习.html">
        mysql进阶学习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.65b26f92.js" defer></script><script src="/assets/js/2.688822e6.js" defer></script><script src="/assets/js/23.fe222df9.js" defer></script>
  </body>
</html>
